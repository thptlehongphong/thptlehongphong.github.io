<!DOCTYPE html><html lang="vi"><head><meta charset="UTF-8"><meta name="viewport" content="width=1100"><title>Admin 2 - Nh·∫≠p D·ªØ Li·ªáu H·ªçc Sinh</title><link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet"><script type="module" src="../firebase-backend.js"></script><style>:root{--primary:#6366f1;--glass:rgba(255, 255, 255, 0.05);--glass-border:rgba(255, 255, 255, 0.1)}*{margin:0;padding:0;box-sizing:border-box;font-family:Outfit,sans-serif}body{background:#0f172a;color:#fff;min-height:100vh;padding:20px 5%}.container{max-width:600px;margin:0 auto}.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.card{background:var(--glass);border:1px solid var(--glass-border);border-radius:24px;padding:25px}.upload-area{border:2px dashed var(--glass-border);border-radius:16px;padding:30px 20px;margin-bottom:24px;cursor:pointer;text-align:center;position:relative}.upload-area input{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.preview-img{width:120px;height:120px;border-radius:50%;object-fit:cover;margin:0 auto 15px;display:none;border:3px solid var(--primary)}.input-group{margin-bottom:15px}.input-group label{display:block;margin-bottom:8px;color:#94a3b8;font-size:.85rem}input{width:100%;padding:12px;border-radius:12px;border:1px solid var(--glass-border);background:rgba(255,255,255,.03);color:#fff;outline:0}.btn{width:100%;padding:14px;border-radius:12px;border:none;font-weight:600;cursor:pointer;transition:.3s;margin-top:10px}.btn-primary{background:var(--primary);color:#fff}.loading-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(15,23,42,.9);z-index:1000;justify-content:center;align-items:center;flex-direction:column}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:2000;justify-content:center;align-items:center;backdrop-filter:blur(5px)}.modal-content{max-width:90%;max-height:90%;border-radius:20px;border:2px solid var(--primary)}.notify-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(15,23,42,.9);z-index:9999;justify-content:center;align-items:center;backdrop-filter:blur(8px)}.notify-content{background:#1e293b;border:1px solid var(--glass-border);padding:30px;border-radius:24px;max-width:400px;width:90%;text-align:center;box-shadow:0 25px 50px -12px rgba(0,0,0,.5);animation:modalPop .2s ease-out}@keyframes modalPop{from{transform:scale(.9);opacity:0}to{transform:scale(1);opacity:1}}.notify-icon{font-size:40px;margin-bottom:15px;display:block}.notify-title{font-size:1.25rem;font-weight:700;margin-bottom:10px}.notify-msg{color:#cbd5e1;line-height:1.5;margin-bottom:25px}.notify-error .notify-title{color:#ef4444}.notify-success .notify-title{color:#10b981}</style></head><body><div class="container"><div class="header"><h3>Admin 2 - Nh·∫≠p D·ªØ Li·ªáu</h3><button style="background:0 0;border:none;color:#fff;cursor:pointer" onclick="logout()">Tho√°t</button></div><div class="card"><div class="upload-area" id="dropZone"><img id="imagePreview" class="preview-img" src="" alt="Preview" onclick="showImg(this.src)"><div id="uploadPlaceholder"><span style="font-size:30px">üì∏</span><p style="margin-bottom:15px">Ch·ªçn ph∆∞∆°ng th·ª©c l·∫•y ·∫£nh h·ªçc sinh</p><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:0 10px"><button class="btn btn-primary" style="font-size:.8rem;padding:10px" onclick='document.getElementById("fileCapture").click()'>Ch·ª•p ·∫£nh</button> <button class="btn" style="background:var(--glass-border);color:#fff;font-size:.8rem;padding:10px" onclick='document.getElementById("fileBrowse").click()'>Ch·ªçn file</button></div></div><input type="file" id="fileCapture" accept="image/*" capture="environment" style="display:none"> <input type="file" id="fileBrowse" accept="image/*" style="display:none"><div id="previewActions" style="display:none;margin-top:10px"><p id="sizeInfo" style="font-size:.8rem;color:#f59e0b;margin-bottom:8px"></p><a id="downloadLink" download="check-5kb.jpg" class="btn" style="background:#10b981;color:#fff;text-decoration:none;display:inline-block;width:auto;padding:8px 15px;font-size:.8rem">T·∫£i v·ªÅ ki·ªÉm tra</a> <button type="button" class="btn" style="background:var(--danger);color:#fff;width:auto;padding:8px 15px;font-size:.8rem" onclick="resetUpload()">L√†m l·∫°i</button></div></div><form id="studentForm"><div class="input-group"><label>H·ªç v√† t√™n h·ªçc sinh</label> <input type="text" id="name" placeholder="VD: Nguy·ªÖn VƒÉn A" required></div><div class="input-group"><label>L·ªõp</label> <select id="class" required><option value="">-- ƒêang t·∫£i danh s√°ch l·ªõp --</option></select></div><div class="input-group"><label>Ng√†y sinh</label> <input type="date" id="dob" required></div><div class="input-group"><label>M√£ s·ªë h·ªçc sinh (MSHS)</label> <input type="text" id="studentId" placeholder="VD: HS123456" required></div><button type="submit" class="btn btn-primary" id="submitBtn">L∆∞u Th√¥ng Tin H·ªá Th·ªëng</button></form></div></div><div id="imageModal" class="modal" onclick="closeImg()"><img class="modal-content" id="imgFull"></div><div class="loading-overlay" id="loader"><p>ƒêang x·ª≠ l√Ω ·∫£nh xu·ªëng 50kB...</p></div><div id="notifyModal" class="notify-modal"><div class="notify-content" id="notifyContent"><span id="notifyIcon" class="notify-icon"></span><h3 id="notifyTitle" class="notify-title"></h3><p id="notifyMsg" class="notify-msg"></p><button type="button" class="btn btn-primary" onclick="closeNotify()">ƒê·ªìng √Ω</button></div></div><script>let API_BASE="",currentRole=sessionStorage.getItem("kyluat_role");async function checkSystemStatus(){try{var e=await(await fetch(API_BASE+"/api/settings")).json(),t=(new Date).toISOString().split("T")[0],o=e.expiry_date&&t>e.expiry_date,a=!1===JSON.parse(e.permissions||'{"admin1":true,"admin2":true,"admin3":true,"admin4":true}')[currentRole];(o||a)&&"admin0"!==currentRole&&(showNotify("Th√¥ng b√°o h·ªá th·ªëng",a?"Quy·ªÅn truy c·∫≠p c·ªßa b·∫°n ƒë√£ b·ªã t·∫°m kh√≥a!":"H·ªá th·ªëng ƒë√£ h·∫øt th·ªùi h·∫°n s·ª≠ d·ª•ng!",!0),setTimeout(()=>window.location.href="../index.html",3e3));let n=document.getElementById("class");n.innerHTML='<option value="">-- Ch·ªçn l·ªõp --</option>',(await(await fetch(API_BASE+"/api/classes")).json()).forEach(e=>{var t=document.createElement("option");t.value=e.name,t.textContent=e.name,n.appendChild(t)})}catch(e){console.error(e)}}"admin2"!==currentRole&&"admin0"!==currentRole&&(window.location.href="../index.html"),checkSystemStatus(),setInterval(checkSystemStatus,3e4);let fileCapture=document.getElementById("fileCapture"),fileBrowse=document.getElementById("fileBrowse"),imgPreview=document.getElementById("imagePreview"),placeholder=document.getElementById("uploadPlaceholder"),previewActions=document.getElementById("previewActions"),sizeInfo=document.getElementById("sizeInfo"),downloadLink=document.getElementById("downloadLink"),studentForm=document.getElementById("studentForm"),loader=document.getElementById("loader"),compressedBase64=null;function showNotify(e,t,n=!1){var o=document.getElementById("notifyModal"),a=document.getElementById("notifyContent"),i=document.getElementById("notifyIcon"),s=document.getElementById("notifyTitle"),l=document.getElementById("notifyMsg");a.className="notify-content "+(n?"notify-error":"notify-success"),i.innerText=n?"‚ö†Ô∏è":"‚úÖ",s.innerText=e,l.innerText=t,o.style.display="flex"}function closeNotify(){document.getElementById("notifyModal").style.display="none"}function resetUpload(){compressedBase64=null,imgPreview.style.display="none",placeholder.style.display="block",previewActions.style.display="none",fileCapture.value="",fileBrowse.value=""}async function compressImage(e){e=await loadImage(e);let t=document.createElement("canvas");var n=800;let o=e.width,a=e.height,i=((o>n||a>n)&&(o>a?(a*=n/o,o=n):(o*=n/a,a=n)),t.width=o,t.height=a,t.getContext("2d").drawImage(e,0,0,o,a),.8),s=await new Promise(e=>t.toBlob(e,"image/jpeg",i));for(;51200<s.size&&.05<i;)i-=.05,s=await new Promise(e=>t.toBlob(e,"image/jpeg",i));return s}function loadImage(t){return new Promise(n=>{var e=new FileReader;e.onload=e=>{let t=new Image;t.onload=()=>n(t),t.src=e.target.result},e.readAsDataURL(t)})}function blobToBase64(n){return new Promise(e=>{let t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(n)})}function logout(){sessionStorage.clear(),window.location.href="../index.html"}[fileCapture,fileBrowse].forEach(e=>{e.addEventListener("change",async e=>{e=e.target.files[0];if(e){loader.style.display="flex";try{var t=await compressImage(e);compressedBase64=await blobToBase64(t),imgPreview.src=compressedBase64,imgPreview.style.display="block",placeholder.style.display="none",previewActions.style.display="block",sizeInfo.textContent=`K√≠ch th∆∞·ªõc: ${(t.size/1024).toFixed(2)} kB`,downloadLink.href=URL.createObjectURL(t)}catch(e){showNotify("L·ªói","L·ªói x·ª≠ l√Ω ·∫£nh!",!0)}finally{loader.style.display="none"}}})}),studentForm.addEventListener("submit",async e=>{if(e.preventDefault(),!compressedBase64)return showNotify("Thi·∫øu ·∫£nh","Vui l√≤ng ch·ª•p ho·∫∑c ch·ªçn ·∫£nh h·ªçc sinh!",!0);loader.style.display="flex";try{var t=await(await fetch(API_BASE+"/api/settings")).json(),n=parseInt(t.default_stars||0),o={id:document.getElementById("studentId").value.trim().toUpperCase(),name:document.getElementById("name").value.trim(),class_name:document.getElementById("class").value.trim(),photo:compressedBase64,stars:n},a=await fetch(API_BASE+"/api/students",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});a.ok?(showNotify("Th√†nh c√¥ng",`ƒê√£ th√™m h·ªçc sinh ${o.name} l√™n h·ªá th·ªëng th√†nh c√¥ng!`),studentForm.reset(),resetUpload()):showNotify("L·ªói n·∫°p d·ªØ li·ªáu",(await a.json()).error||"L·ªói khi l∆∞u d·ªØ li·ªáu!",!0)}catch(e){showNotify("L·ªói k·∫øt n·ªëi","L·ªói: "+e.message,!0)}finally{loader.style.display="none"}})</script></body></html>