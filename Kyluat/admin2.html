<!DOCTYPE html><html lang="vi"><head><meta charset="UTF-8"><meta name="viewport" content="width=1100"><title>Admin 2 - Nh·∫≠p D·ªØ Li·ªáu H·ªçc Sinh</title><link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet"><script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script><script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script><style>:root{--primary:#6366f1;--glass:rgba(255, 255, 255, 0.05);--glass-border:rgba(255, 255, 255, 0.1)}*{margin:0;padding:0;box-sizing:border-box;font-family:Outfit,sans-serif}body{background:#0f172a;color:#fff;min-height:100vh;padding:20px 5%}.container{max-width:600px;margin:0 auto}.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.card{background:var(--glass);border:1px solid var(--glass-border);border-radius:24px;padding:25px}.upload-area{border:2px dashed var(--glass-border);border-radius:16px;padding:30px 20px;margin-bottom:24px;cursor:pointer;text-align:center;position:relative}.upload-area input{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.preview-img{width:120px;height:120px;border-radius:50%;object-fit:cover;margin:0 auto 15px;display:none;border:3px solid var(--primary)}.input-group{margin-bottom:15px}.input-group label{display:block;margin-bottom:8px;color:#94a3b8;font-size:.85rem}input{width:100%;padding:12px;border-radius:12px;border:1px solid var(--glass-border);background:rgba(255,255,255,.03);color:#fff;outline:0}.btn{width:100%;padding:14px;border-radius:12px;border:none;font-weight:600;cursor:pointer;transition:.3s;margin-top:10px}.btn-primary{background:var(--primary);color:#fff}.loading-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(15,23,42,.9);z-index:1000;justify-content:center;align-items:center;flex-direction:column}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:2000;justify-content:center;align-items:center;backdrop-filter:blur(5px)}.modal-content{max-width:90%;max-height:90%;border-radius:20px;border:2px solid var(--primary)}</style></head><body><div class="container"><div class="header"><h3>Admin 2 - Nh·∫≠p D·ªØ Li·ªáu</h3><button style="background:0 0;border:none;color:#fff;cursor:pointer" onclick="logout()">Tho√°t</button></div><div class="card"><div class="upload-area" id="dropZone"><img id="imagePreview" class="preview-img" src="" alt="Preview" onclick="showImg(this.src)"><div id="uploadPlaceholder"><span style="font-size:30px">üì∏</span><p style="margin-bottom:15px">Ch·ªçn ph∆∞∆°ng th·ª©c l·∫•y ·∫£nh h·ªçc sinh</p><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:0 10px"><button class="btn btn-primary" style="font-size:.8rem;padding:10px" onclick='document.getElementById("fileCapture").click()'>Ch·ª•p ·∫£nh</button> <button class="btn" style="background:var(--glass-border);color:#fff;font-size:.8rem;padding:10px" onclick='document.getElementById("fileBrowse").click()'>Ch·ªçn file</button></div></div><input type="file" id="fileCapture" accept="image/*" capture="environment" style="display:none"> <input type="file" id="fileBrowse" accept="image/*" style="display:none"><div id="previewActions" style="display:none;margin-top:10px"><p id="sizeInfo" style="font-size:.8rem;color:#f59e0b;margin-bottom:8px"></p><a id="downloadLink" download="check-5kb.jpg" class="btn" style="background:#10b981;color:#fff;text-decoration:none;display:inline-block;width:auto;padding:8px 15px;font-size:.8rem">T·∫£i v·ªÅ ki·ªÉm tra</a> <button type="button" class="btn" style="background:var(--danger);color:#fff;width:auto;padding:8px 15px;font-size:.8rem" onclick="resetUpload()">L√†m l·∫°i</button></div></div><form id="studentForm"><div class="input-group"><label>H·ªç v√† t√™n h·ªçc sinh</label> <input type="text" id="name" placeholder="VD: Nguy·ªÖn VƒÉn A" required></div><div class="input-group"><label>L·ªõp</label> <select id="class" required><option value="">-- ƒêang t·∫£i danh s√°ch l·ªõp --</option></select></div><div class="input-group"><label>Ng√†y sinh</label> <input type="date" id="dob" required></div><div class="input-group"><label>M√£ s·ªë h·ªçc sinh (MSHS)</label> <input type="text" id="studentId" placeholder="VD: HS123456" required></div><button type="submit" class="btn btn-primary" id="submitBtn">L∆∞u Th√¥ng Tin H·ªá Th·ªëng</button></form></div></div><div id="imageModal" class="modal" onclick="closeImg()"><img class="modal-content" id="imgFull"></div><div class="loading-overlay" id="loader"><p>ƒêang x·ª≠ l√Ω ·∫£nh xu·ªëng 5kB...</p></div><script src="firebase.config.js"></script><script>let currentRole=sessionStorage.getItem("kyluat_role");function showImg(e){var t;e&&(t=document.getElementById("imageModal"),document.getElementById("imgFull").src=e,t.style.display="flex")}function closeImg(){document.getElementById("imageModal").style.display="none"}"admin2"!==currentRole&&"admin0"!==currentRole&&(window.location.href="../index.html"),rootRef.child("Settings/Config").on("value",e=>{var e=e.val()||{status:"active"},t=(new Date).toISOString().split("T")[0],t=e.expiryDate&&t>e.expiryDate,n="locked"===e.status;(t||n)&&"admin0"!==currentRole&&(alert(e.message||"H·ªá th·ªëng ƒë√£ b·ªã kh√≥a ho·∫∑c h·∫øt h·∫°n!"),window.location.href="../index.html")});let fileCapture=document.getElementById("fileCapture"),fileBrowse=document.getElementById("fileBrowse"),imgPreview=document.getElementById("imagePreview"),placeholder=document.getElementById("uploadPlaceholder"),previewActions=document.getElementById("previewActions"),sizeInfo=document.getElementById("sizeInfo"),downloadLink=document.getElementById("downloadLink"),studentForm=document.getElementById("studentForm"),loader=document.getElementById("loader"),compressedBase64=null;function resetUpload(){compressedBase64=null,imgPreview.style.display="none",placeholder.style.display="block",previewActions.style.display="none",fileCapture.value="",fileBrowse.value=""}async function compressImage(e){e=await loadImage(e);let n=document.createElement("canvas");var t=n.getContext("2d");let l=e.width,a=e.height;var o=300;(l>o||a>o)&&(l>a?(a*=o/l,l=o):(l*=o/a,a=o)),n.width=l,n.height=a,t.drawImage(e,0,0,l,a);let i=.6,d=await new Promise(e=>n.toBlob(e,"image/jpeg",i));for(;5120<d.size&&.05<i;)i-=.05,d=await new Promise(e=>n.toBlob(e,"image/jpeg",i));let s=.8;for(;5120<d.size&&.2<s;){let t=document.createElement("canvas");t.width=n.width*s,t.height=n.height*s,t.getContext("2d").drawImage(n,0,0,t.width,t.height),d=await new Promise(e=>t.toBlob(e,"image/jpeg",.3)),s-=.1}return d}function loadImage(l){return new Promise((n,e)=>{var t=new FileReader;t.onload=e=>{let t=new Image;t.onload=()=>n(t),t.src=e.target.result},t.readAsDataURL(l)})}function blobToBase64(n){return new Promise(e=>{let t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(n)})}function logout(){sessionStorage.clear(),window.location.href="../index.html"}[fileCapture,fileBrowse].forEach(e=>{e.addEventListener("change",async e=>{e=e.target.files[0];if(e){loader.style.display="flex";try{var t=await compressImage(e);compressedBase64=await blobToBase64(t),imgPreview.src=compressedBase64,imgPreview.style.display="block",placeholder.style.display="none",previewActions.style.display="block",sizeInfo.textContent=`K√≠ch th∆∞·ªõc: ${(t.size/1024).toFixed(2)} kB`,downloadLink.href=URL.createObjectURL(t)}catch(e){alert("L·ªói x·ª≠ l√Ω ·∫£nh!")}finally{loader.style.display="none"}}})}),studentForm.addEventListener("submit",async e=>{if(e.preventDefault(),compressedBase64){var e=(await rootRef.child("Settings/DefaultStars").once("value")).val()||0,t={name:document.getElementById("name").value.trim(),class:document.getElementById("class").value.trim(),dob:document.getElementById("dob").value,studentId:document.getElementById("studentId").value.trim().toUpperCase(),photo:compressedBase64,stars:e,createdAt:Date.now()};loader.style.display="flex";try{(await rootRef.child("Students").child(t.studentId).once("value")).exists()?(alert(`M√£ s·ªë h·ªçc sinh "${t.studentId}" ƒë√£ t·ªìn t·∫°i tr√™n h·ªá th·ªëng! Vui l√≤ng ki·ªÉm tra l·∫°i ho·∫∑c nh·∫≠p m√£ kh√°c.`),loader.style.display="none"):(await rootRef.child("Students").child(t.studentId).set(t),alert(`ƒê√£ th√™m h·ªçc sinh th√†nh c√¥ng v·ªõi ${e} ƒëi·ªÉm r√®n luy·ªán ban ƒë·∫ßu!`),studentForm.reset(),resetUpload())}catch(e){alert("L·ªói khi l∆∞u d·ªØ li·ªáu!")}finally{loader.style.display="none"}}else alert("Vui l√≤ng ch·ª•p ho·∫∑c ch·ªçn ·∫£nh h·ªçc sinh!")}),rootRef.child("Classes").on("value",e=>{let n=document.getElementById("class");n.innerHTML='<option value="">-- Ch·ªçn l·ªõp --</option>',e.exists()?e.forEach(e=>{var t=document.createElement("option");t.value=e.key,t.textContent=e.key,n.appendChild(t)}):n.innerHTML='<option value="">Ch∆∞a c√≥ l·ªõp n√†o (Li√™n h·ªá Admin 1)</option>'})</script></body></html>