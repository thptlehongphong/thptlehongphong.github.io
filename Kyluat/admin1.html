<!DOCTYPE html><html lang="vi"><head><meta charset="UTF-8"><meta name="viewport" content="width=1100"><title>Admin 1 - Quáº£n LÃ½ Há»‡ Thá»‘ng</title><link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet"><script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script><script src="../student_data.js"></script><script type="module" src="../firebase-backend.js"></script><style>:root{--primary:#6366f1;--glass:rgba(255, 255, 255, 0.05);--glass-border:rgba(255, 255, 255, 0.1);--danger:#ef4444}*{margin:0;padding:0;box-sizing:border-box;font-family:Outfit,sans-serif}body{background:#0f172a;color:#fff;min-height:100vh;padding:40px 5%}.container{max-width:1200px;margin:0 auto}.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:40px}.card{background:var(--glass);border:1px solid var(--glass-border);border-radius:20px;padding:30px;margin-bottom:30px}.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}input,select{width:100%;padding:12px;border-radius:10px;border:1px solid var(--glass-border);background:#1e293b;color:#fff;outline:0}select option{background-color:#0f172a;color:#fff}.btn{padding:12px 24px;border-radius:10px;border:none;font-weight:600;cursor:pointer;transition:.3s;display:inline-flex;align-items:center;justify-content:center;gap:5px}.btn-primary{background:var(--primary);color:#fff;width:100%}.btn-danger-outline{background:rgba(239,68,68,.1);color:var(--danger);border:1px solid rgba(239,68,68,.2)}.btn-success{background:#10b981;color:#fff}table{width:100%;border-collapse:collapse;margin-top:10px}th{text-align:left;padding:12px 15px;color:#94a3b8;border-bottom:1px solid var(--glass-border);font-size:.75rem;text-transform:uppercase;letter-spacing:.05em}td{padding:12px 15px;border-bottom:1px solid rgba(255,255,255,.03);vertical-align:middle}.student-img{width:38px;height:38px;border-radius:10px;object-fit:cover;border:1px solid var(--glass-border);cursor:zoom-in;box-shadow:0 4px 6px -1px rgba(0,0,0,.1)}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(15,23,42,.85);z-index:2000;justify-content:center;align-items:center;backdrop-filter:blur(10px)}.modal-content{background:linear-gradient(135deg,#1e293b 0,#0f172a 100%);padding:32px;border-radius:28px;max-width:480px;width:90%;border:1px solid rgba(255,255,255,.1);box-shadow:0 25px 50px -12px rgba(0,0,0,.7);animation:modalSlideUp .3s ease-out}@keyframes modalSlideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.confirm-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(15,23,42,.9);z-index:9999;justify-content:center;align-items:center;backdrop-filter:blur(8px)}.confirm-modal-content{background:#1e293b;border:1px solid var(--glass-border);padding:30px;border-radius:24px;max-width:400px;width:90%;text-align:center;box-shadow:0 25px 50px -12px rgba(0,0,0,.5);animation:modalPop .2s ease-out}@keyframes modalPop{from{transform:scale(.9);opacity:0}to{transform:scale(1);opacity:1}}.confirm-modal-btns{display:flex;gap:12px;margin-top:25px}.confirm-modal-btns .btn{flex:1;padding:12px}.pagination{display:flex;justify-content:center;gap:8px;margin-top:15px}.page-btn{padding:8px 14px;background:var(--glass);border:1px solid var(--glass-border);color:#94a3b8;border-radius:8px;cursor:pointer;font-size:.85rem;transition:.3s}.page-btn:hover:not(:disabled){background:rgba(255,255,255,.1);border-color:var(--primary);color:#fff}.page-btn:disabled{opacity:.3;cursor:not-allowed}.page-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}</style></head><body><div class="container"><div class="header"><div><h1 style="font-size:2.5rem;letter-spacing:-1px">Admin 1 <span style="color:var(--primary);font-size:1.2rem;font-weight:400">/ Quáº£n trá»‹ há»‡ thá»‘ng</span></h1><p style="color:#94a3b8;margin-top:5px">Quáº£n lÃ½ tÃ i khoáº£n, há»c sinh vÃ  lá»‹ch sá»­ vi pháº¡m</p></div><button type="button" class="btn" style="background:rgba(255,255,255,.05);border:1px solid var(--glass-border);color:#fff" onclick="logout()">ÄÄƒng xuáº¥t</button></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:30px;margin-bottom:40px"><div class="card" style="margin-bottom:0"><h3 style="margin-bottom:20px">ğŸ‘¤ Táº¡o TÃ i Khoáº£n</h3><form id="createAdminForm" onsubmit="return!1"><div class="form-grid" style="grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px"><div><input type="text" id="adminId" placeholder="ID" required></div><div><input type="password" id="adminPass" placeholder="Máº­t kháº©u" required></div></div><div style="display:flex;gap:12px"><select id="adminRole" style="flex:1"><option value="admin2">Admin 2 (Nháº­p liá»‡u)</option><option value="admin3">Admin 3 (Cá» Ä‘á»)</option><option value="admin4">Admin 4 (Khen thÆ°á»Ÿng)</option></select> <button type="button" class="btn btn-primary" style="width:auto" onclick="addAdminAccount()">Táº¡o</button></div></form><div style="max-height:150px;overflow-y:auto;margin-top:15px;border-top:1px solid var(--glass-border);padding-top:10px"><table><thead><tr style="font-size:.7rem;color:#94a3b8"><th>ID</th><th>Máº­t kháº©u</th><th>Quyá»n</th><th style="text-align:right">XÃ³a</th></tr></thead><tbody id="adminTableBody"></tbody></table></div></div><div class="card" style="margin-bottom:0"><h3 style="margin-bottom:20px">ğŸ« Quáº£n LÃ½ Lá»›p Há»c</h3><div style="display:flex;gap:10px;margin-bottom:15px"><input type="text" id="className" placeholder="TÃªn lá»›p (10A1...)"> <button type="button" class="btn btn-primary" style="width:auto" onclick="addClass()">ThÃªm</button></div><div id="classListArea" style="display:flex;flex-wrap:wrap;gap:8px;max-height:150px;overflow-y:auto"></div></div></div><div class="card"><h3 style="margin-bottom:20px">âš™ï¸ Cáº¥u HÃ¬nh Há»‡ Thá»‘ng</h3><div style="display:grid;grid-template-columns:1fr 1fr;gap:40px"><div><h4 style="margin-bottom:10px;color:var(--primary)">â­ Äiá»ƒm Ban Äáº§u</h4><div style="display:flex;gap:10px;margin-bottom:15px"><input type="number" id="defaultStarInput" style="width:100px"> <button type="button" class="btn btn-primary" onclick="saveDefaultStars()">LÆ°u máº·c Ä‘á»‹nh</button></div><button type="button" class="btn btn-danger-outline" style="width:100%;justify-content:flex-start;margin-bottom:10px" onclick="applyDefaultToAll()">âš ï¸ Reset Ä‘iá»ƒm toÃ n bá»™ há»c sinh</button> <button type="button" class="btn btn-danger-outline" style="width:100%;justify-content:flex-start" onclick="deleteAllViolations()">ğŸ—‘ï¸ XÃ³a sáº¡ch lá»‹ch sá»­ vi pháº¡m</button></div><div><div style="margin-bottom:20px"><h4 style="color:var(--danger);margin-bottom:10px">ğŸ›‘ Loáº¡i Vi Pháº¡m</h4><div style="display:flex;gap:10px;margin-bottom:10px"><input type="text" id="newVType" placeholder="TÃªn lá»—i"> <input type="number" id="newVPoint" placeholder="Äiá»ƒm" style="width:80px"> <button type="button" class="btn btn-success" onclick='addConfig("ViolationTypes")'>+</button></div><div id="violationTypeList" style="max-height:120px;overflow-y:auto;background:rgba(0,0,0,.1);padding:10px;border-radius:10px"></div></div><div><h4 style="color:#10b981;margin-bottom:10px">âœ¨ Loáº¡i Khen ThÆ°á»Ÿng</h4><div style="display:flex;gap:10px;margin-bottom:10px"><input type="text" id="newRType" placeholder="TÃªn hÄ‘"> <input type="number" id="newRPoint" placeholder="Äiá»ƒm" style="width:80px"> <button type="button" class="btn btn-success" onclick='addConfig("RewardTypes")'>+</button></div><div id="rewardTypeList" style="max-height:120px;overflow-y:auto;background:rgba(0,0,0,.1);padding:10px;border-radius:10px"></div></div></div></div></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:30px"><div class="card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px"><h3>ğŸ“‘ Lá»‹ch Sá»­ Vi Pháº¡m</h3><div style="display:flex;gap:10px"><button type="button" class="btn" onclick="exportViolationsExcel()">ğŸ“¥ Excel</button> <input type="text" id="searchViolation" placeholder="TÃ¬m kiáº¿m..." style="width:120px" oninput="filterViolations()"></div></div><div style="max-height:500px;overflow-y:auto"><table><tbody id="violationManageBody"></tbody></table></div><div id="violationPagination" class="pagination" style="display:flex;justify-content:center;gap:5px;margin-top:15px"></div></div><div class="card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px"><h3>ğŸ“ Danh SÃ¡ch Há»c Sinh</h3><div style="display:flex;gap:10px"><button type="button" class="btn" onclick="exportStudentsExcel()">ğŸ“¥ Excel</button> <input type="text" id="searchStudent" placeholder="TÃ¬m kiáº¿m..." style="width:120px" oninput="filterStudents()"></div></div><div style="max-height:500px;overflow-y:auto"><table><thead><tr style="font-size:.75rem;color:#94a3b8"><th>Há»c sinh</th><th>Lá»›p</th><th style="text-align:right">HÃ nh Ä‘á»™ng</th></tr></thead><tbody id="studentManageBody"></tbody></table></div><div id="studentPagination" class="pagination" style="display:flex;justify-content:center;gap:5px;margin-top:15px"></div></div></div><div class="card" style="margin-top:20px;border:1px solid rgba(99,102,241,.3);background:rgba(15,23,42,.4)"><div style="text-align:center;margin-bottom:40px"><h2 style="font-size:2rem;color:#818cf8;margin-bottom:10px">ğŸ“– Cáº¨M NANG Váº¬N HÃ€NH Há»† THá»NG QUáº¢N LÃ RÃˆN LUYá»†N</h2></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:40px"><div><section style="margin-bottom:30px"><h3 style="color:#fff;border-left:4px solid var(--primary);padding-left:15px;margin-bottom:20px;font-size:1.2rem">ğŸ”¹ PHÃ‚N Cáº¤P VÃ€ NHIá»†M Vá»¤ QUáº¢N TRá»Š</h3><div style="display:flex;flex-direction:column;gap:15px"><div style="background:rgba(255,255,255,.03);padding:15px;border-radius:12px"><div style="display:flex;align-items:center;gap:10px;margin-bottom:8px"><span style="background:var(--primary);width:24px;height:24px;display:flex;align-items:center;justify-content:center;border-radius:6px;font-size:.8rem;font-weight:700">1</span> <strong style="color:#818cf8">Admin 1 - Tá»•ng Quáº£n</strong></div><p style="font-size:.9rem;color:#cbd5e1;margin-left:34px">ÄÃ¢y lÃ  tÃ i khoáº£n cá»§a Ban GiÃ¡m Hiá»‡u hoáº·c Tá»• CNTT. Nhiá»‡m vá»¥ lÃ  thiáº¿t káº¿ "luáº­t chÆ¡i": thiáº¿t láº­p má»©c Ä‘iá»ƒm ban Ä‘áº§u, táº¡o danh má»¥c cÃ¡c lá»—i vi pháº¡m vÃ  khen thÆ°á»Ÿng kÃ¨m Ä‘iá»ƒm sá»‘ tÆ°Æ¡ng á»©ng. Admin 1 náº¯m giá»¯ chÃ¬a khÃ³a dá»¯ liá»‡u, cÃ³ quyá»n xuáº¥t Excel Ä‘á»ƒ bÃ¡o cÃ¡o trong cÃ¡c ká»³ sÆ¡ káº¿t.</p></div><div style="background:rgba(255,255,255,.03);padding:15px;border-radius:12px"><div style="display:flex;align-items:center;gap:10px;margin-bottom:8px"><span style="background:#10b981;width:24px;height:24px;display:flex;align-items:center;justify-content:center;border-radius:6px;font-size:.8rem;font-weight:700">2</span> <strong style="color:#10b981">Admin 2 - Nháº­p Liá»‡u (NgÆ°á»i xÃ¢y ná»n mÃ³ng)</strong></div><p style="font-size:.9rem;color:#cbd5e1;margin-left:34px">CÃ´ng viá»‡c diá»…n ra chá»§ yáº¿u Ä‘áº§u nÄƒm há»c: Chá»¥p áº£nh trá»±c tiáº¿p hoáº·c táº£i lÃªn áº£nh há»c sinh kÃ¨m thÃ´ng tin cá»§a há»c sinh. Má»—i há»c sinh sáº½ cÃ³ 1 mÃ£ Ä‘á»‹nh danh (ID) duy nháº¥t trong suá»‘t 1 nÄƒm há»c. KhÃ´ng thá»ƒ thay Ä‘á»•i ID nÃ y trá»« khi ADMIN 1 xoÃ¡ há»c sinh.</p></div><div style="background:rgba(255,255,255,.03);padding:15px;border-radius:12px"><div style="display:flex;align-items:center;gap:10px;margin-bottom:8px"><span style="background:var(--danger);width:24px;height:24px;display:flex;align-items:center;justify-content:center;border-radius:6px;font-size:.8rem;font-weight:700">3</span> <strong style="color:#ef4444">Admin 3 - Cá» Äá» & GiÃ¡m Thá»‹ (Thá»±c thi)</strong></div><p style="font-size:.9rem;color:#cbd5e1;margin-left:34px">ÄÃ¢y lÃ  cÃ´ng cá»¥ di Ä‘á»™ng chuyÃªn dá»¥ng. Äá»™i cá» Ä‘á» cáº§m Ä‘iá»‡n thoáº¡i, chá»‰ cáº§n nháº­p ID cá»§a há»c sinh hoáº·c quÃ©t mÃ£ QR trÃªn tháº» há»c sinh, xe mÃ¡y, xe Ä‘áº¡p cÃ³ gáº¯n mÃ£ QR sáº½ tá»± Ä‘á»™ng truy xuáº¥t ra thÃ´ng tin cá»§a há»c sinh vÃ  ghi nháº­n cÃ¡c lá»—i vi pháº¡m. ToÃ n bá»™ lá»—i vi pháº¡m sáº½ Ä‘Æ°á»£c ghi nháº­n lÃªn "Báº£ng vi pháº¡m Live" trÃªn trang chá»§ trong 1-2 giÃ¢y, loáº¡i bá» hoÃ n toÃ n viá»‡c sá»• sÃ¡ch thá»§ cÃ´ng.</p></div><div style="background:rgba(255,255,255,.03);padding:15px;border-radius:12px"><div style="display:flex;align-items:center;gap:10px;margin-bottom:8px"><span style="background:#f59e0b;width:24px;height:24px;display:flex;align-items:center;justify-content:center;border-radius:6px;font-size:.8rem;font-weight:700">4</span> <strong style="color:#f59e0b">Admin 4 (Khen thÆ°á»Ÿng)</strong></div><p style="font-size:.9rem;color:#cbd5e1;margin-left:34px">Admin 4 chá»©c nÄƒng tÆ°Æ¡ng tá»± nhÆ° ADMIN 3 nhÆ°ng lÃ  khen thÆ°á»Ÿng vÃ  + Ä‘iá»ƒm cho há»c sinh.</p></div></div></section></div><div><section style="margin-bottom:30px"><h3 style="color:#fff;border-left:4px solid #818cf8;padding-left:15px;margin-bottom:20px;font-size:1.2rem">âš¡ QUY TRÃŒNH Váº¬N HÃ€NH</h3><div style="background:rgba(99,102,241,.05);border:1px dashed rgba(99,102,241,.3);padding:20px;border-radius:16px"><div style="margin-bottom:20px"><h4 style="color:#fff;margin-bottom:8px;font-size:1rem">ğŸ BÆ°á»›c 1: Khá»Ÿi táº¡o má»—i há»c ká»³</h4><ol style="padding-left:20px;color:#cbd5e1;font-size:.9rem"><li>Admin 1 sá»­ dá»¥ng tÃ­nh nÄƒng <strong>"XÃ³a sáº¡ch lá»‹ch sá»­ vi pháº¡m"</strong> Ä‘á»ƒ dá»n dáº¹p dá»¯ liá»‡u cÅ©.</li><li>Sá»­ dá»¥ng <strong>"Reset Ä‘iá»ƒm toÃ n bá»™ há»c sinh"</strong> Ä‘á»ƒ Ä‘Æ°a cÃ¡c em vá» váº¡ch xuáº¥t phÃ¡t (VD: 100 sao).</li></ol></div><div style="margin-bottom:20px"><h4 style="color:#fff;margin-bottom:8px;font-size:1rem">ğŸ“… BÆ°á»›c 2: Duy trÃ¬ háº±ng ngÃ y</h4><ul style="padding-left:20px;color:#cbd5e1;font-size:.9rem"><li>Äá»™i Cá» Äá» trá»±c táº¡i cá»•ng trÆ°á»ng vá»›i tÃ i khoáº£n Admin 3. ÄÄƒng nháº­p nhÆ° bÃ¬nh thÆ°á»ng vá»›i ID vÃ  Pass cá»§a Admin 3 do Admin 1 (lÃ  báº¡n) táº¡o ra</li><li>GiÃ¡o viÃªn bá»™ mÃ´n khen thÆ°á»Ÿng táº¡i lá»›p vá»›i tÃ i khoáº£n Admin 4 (tÆ°Æ¡ng tá»± Admin 3).</li><li>Má»i thay Ä‘á»•i sáº½ hiá»‡n ngay trÃªn <strong>Live Dashboard</strong> á»Ÿ sáº£nh trÆ°á»ng hoáº·c website cÃ´ng cá»™ng. Táº¥t cáº£ phá»¥ huynh, há»c sinh, giÃ¡o viÃªn Ä‘á»u cÃ³ thá»ƒ xem Ä‘Æ°á»£c</li></ul></div><div><h4 style="color:#fff;margin-bottom:8px;font-size:1rem">ğŸ“ˆ BÆ°á»›c 3: Tá»•ng káº¿t</h4><p style="color:#cbd5e1;font-size:.9rem">Admin 1 truy cáº­p má»¥c <strong>"Lá»‹ch sá»­ vi pháº¡m"</strong>, lá»c theo thá»i gian vÃ  báº¥m <strong>"ğŸ“¥ Excel"</strong>. Dá»¯ liá»‡u nÃ y Ä‘Ã£ Ä‘Æ°á»£c sáº¯p xáº¿p sáºµn, chá»‰ cáº§n in ra Ä‘á»ƒ Ä‘á»ƒ sá»­ dá»¥ng.</p></div></div></section><section><h3 style="color:#fff;border-left:4px solid #10b981;padding-left:15px;margin-bottom:15px;font-size:1.2rem">ğŸ’¡ Máº¸O QUáº¢N TRá»Š</h3><div style="display:flex;flex-direction:column;gap:10px;font-size:.9rem;color:#cbd5e1"><p>âœ… <strong>Sá»­ dá»¥ng QR Code:</strong> In mÃ£ QR há»c sinh (náº±m bÃªn ngoÃ i trang chá»§ pháº§n danh sÃ¡ch toÃ n trÆ°á»ng) gáº¯n sau tháº» tÃªn hoáº·c gháº¿ ngá»“i, xe Ä‘áº¡p, xe mÃ¡y Ä‘á»ƒ viá»‡c kiá»ƒm tra diá»…n ra nhanh hÆ¡n.</p><p>âœ… <strong>TÃ­nh nÄƒng HoÃ n tÃ¡c (Undo):</strong> Náº¿u ghi nháº§m lá»—i, hÃ£y vÃ o ADMIN 1 vÃ  vÃ o má»¥c Lá»‹ch sá»­ vÃ  báº¥m â†©ï¸ Ä‘á»ƒ xÃ³a lá»—i vÃ  tá»± Ä‘á»™ng hoÃ n tráº£ Ä‘iá»ƒm cho há»c sinh ngay láº­p tá»©c.</p><p>âœ… <strong>Äá»“ng bá»™ Khá»‘i lá»›p:</strong> Há»‡ thá»‘ng tá»± Ä‘á»™ng nháº­n diá»‡n khá»‘i (6, 7, 8...) Ä‘á»ƒ táº¡o báº£ng xáº¿p háº¡ng thi Ä‘ua giá»¯a cÃ¡c lá»›p trong cÃ¹ng khá»‘i.</p><p>âœ… <strong>Báº£o máº­t:</strong> Náº¿u nghi ngá» lá»™ máº­t kháº©u, hÃ£y dÃ¹ng Admin 1 Ä‘á»ƒ xÃ³a tÃ i khoáº£n cÅ© vÃ  cáº¥p láº¡i tÃ i khoáº£n má»›i nhanh chÃ³ng.</p><p>âœ… <strong>GÃ³c thÃ´ng tin & Tiá»‡n Ã­ch:</strong> ThÆ°á»ng xuyÃªn cáº­p nháº­t cÃ¡c thÃ´ng tin há»¯u Ã­ch Ä‘á»ƒ phá»¥ huynh vÃ  há»c sinh cÃ³ thá»ƒ náº¯m Ä‘Æ°á»£c cÃ¡c thÃ´ng tin ngoáº¡i khoÃ¡ cá»§a nhÃ  trÆ°á»ng. Hoáº·c báº¥t ká»ƒ khi muá»‘n bá»‘ trÃ­ quáº£ng cÃ¡o hÃ£y liÃªn há»‡ chÃºng tÃ´i Ä‘á»ƒ nÃ¢ng cáº¥p</p></div></section></div></div><div style="margin-top:40px;padding-top:20px;border-top:1px solid var(--glass-border);text-align:center"><p style="font-size:.85rem;color:#64748b;font-style:italic">Há»‡ thá»‘ng Ä‘Æ°á»£c phÃ¡t triá»ƒn chuyÃªn sÃ¢u cho cÃ¡c trÆ°á»ng phá»• thÃ´ng táº¡i Viá»‡t Nam. Má»i tháº¯c máº¯c ká»¹ thuáº­t vui lÃ²ng liÃªn há»‡ Admin 0.</p></div></div></div><div id="imageModal" class="modal" onclick="closeImg()"><img id="imgFull" style="max-width:90%;max-height:90%;border-radius:20px;border:2px solid var(--primary)"></div><div id="confirmModal" class="confirm-modal"><div class="confirm-modal-content"><h3 style="margin-bottom:15px;color:var(--danger)">âš ï¸ XÃ¡c Nháº­n</h3><p id="confirmMsg" style="color:#cbd5e1;line-height:1.5;font-size:.95rem"></p><div class="confirm-modal-btns"><button type="button" class="btn btn-primary" id="btnConfirmYes">Äá»“ng Ã½</button> <button type="button" class="btn" style="background:#475569;color:#fff" onclick="closeConfirm()">ThoÃ¡t</button></div></div></div><div id="editStudentModal" class="modal"><div class="modal-content" style="max-width:400px"><h3 style="margin-bottom:20px">Sá»­a ThÃ´ng Tin Há»c Sinh</h3><input type="hidden" id="editSid"><div style="margin-bottom:15px"><label style="font-size:.8rem;color:#94a3b8">Há» tÃªn</label> <input type="text" id="editName"></div><div style="margin-bottom:20px"><label style="font-size:.8rem;color:#94a3b8">Lá»›p</label> <select id="editClass"></select></div><div style="display:flex;gap:10px"><button type="button" class="btn btn-primary" onclick="saveStudentEdit()">LÆ°u</button> <button type="button" class="btn" style="background:#475569;color:#fff" onclick="closeEditModal()">Há»§y</button></div></div></div><script>let API_BASE="",role=sessionStorage.getItem("kyluat_role"),allStudents=("admin1"!==role&&"admin0"!==role&&(window.location.href="../index.html"),[]),allViolations=[],configs={ViolationTypes:{},RewardTypes:{},DefaultStars:0},studentPage=1,violationPage=1,pageSize=10,confirmCallback=null;function showConfirm(e,t){document.getElementById("confirmMsg").innerText=e,document.getElementById("confirmModal").style.display="flex",confirmCallback=t}function closeConfirm(){document.getElementById("confirmModal").style.display="none",confirmCallback=null}async function init(){await Promise.all([fetchConfigs(),fetchAdmins(),fetchStudents(),fetchHistory(),fetchClasses()])}async function fetchConfigs(){try{var e=await(await fetch(API_BASE+"/api/settings")).json(),t=(configs={ViolationTypes:JSON.parse(e.violationtypes||"{}"),RewardTypes:JSON.parse(e.rewardtypes||"{}"),DefaultStars:parseInt(e.default_stars||0)},document.getElementById("defaultStarInput").value=configs.DefaultStars,renderConfigs("ViolationTypes","violationTypeList"),renderConfigs("RewardTypes","rewardTypeList"),(new Date).toISOString().split("T")[0]),n=e.expiry_date&&t>e.expiry_date,a=JSON.parse(e.permissions||'{"admin1":true,"admin2":true,"admin3":true,"admin4":true}'),i=sessionStorage.getItem("kyluat_role"),o=!1===a[i];(n||o)&&"admin0"!==i&&(window.location.href="../index.html")}catch(e){console.error(e)}}async function fetchAdmins(){try{var e=await(await fetch(API_BASE+"/api/admins")).json();let n=document.getElementById("adminTableBody");n.innerHTML="",e.forEach(e=>{var t;"admin0"!==e.role&&"admin1"!==e.role&&((t=document.createElement("tr")).innerHTML=`
                        <td style="font-weight: 600; font-size: 0.85rem;">${e.username}</td>
                        <td style="color: #94a3b8; font-size: 0.8rem;">${e.password}</td>
                        <td style="color: #818cf8; font-weight: 600; font-size: 0.8rem;">${e.role}</td>
                        <td style="text-align: right;"><button type="button" class="btn" style="padding: 4px 8px; font-size: 0.7rem; color: #ef4444;" onclick="deleteAdmin('${e.username}')">XÃ³a</button></td>
                    `,n.appendChild(t))})}catch(e){console.error(e)}}async function fetchStudents(){try{var e=localStorage.getItem("fb_mock_students_data");if(e)try{allStudents=JSON.parse(e),renderStudents()}catch(e){}var t,n=await fetch(API_BASE+"/api/students");n.ok&&(t=await n.json(),JSON.stringify(t)!==JSON.stringify(allStudents))&&(allStudents=t,renderStudents())}catch(e){console.error(e)}}async function fetchHistory(){try{var e=localStorage.getItem("fb_mock_history_data");if(e)try{allViolations=JSON.parse(e),renderViolations()}catch(e){}var t,n=await fetch(API_BASE+"/api/history");n.ok&&(t=await n.json(),JSON.stringify(t)!==JSON.stringify(allViolations))&&(allViolations=t,renderViolations())}catch(e){console.error(e)}}async function fetchClasses(){try{var e=await(await fetch(API_BASE+"/api/classes")).json();let n=document.getElementById("classListArea"),a=document.getElementById("editClass");n.innerHTML="",a.innerHTML='<option value="">-- Chá»n lá»›p --</option>',e.forEach(e=>{var t=document.createElement("div"),t=(t.style="background: rgba(255,255,255,0.1); padding: 4px 10px; border-radius: 12px; font-size: 0.8rem; display: flex; align-items: center; gap: 5px;",t.innerHTML=e.name+` <span style="cursor: pointer; color: #ef4444; font-weight: bold;" onclick="deleteClass('${e.name}')">Ã—</span>`,n.appendChild(t),document.createElement("option"));t.value=e.name,t.textContent=e.name,a.appendChild(t)})}catch(e){console.error(e)}}function renderStudents(){let n=document.getElementById("studentManageBody"),t=(n.innerHTML="",document.getElementById("searchStudent").value.toLowerCase());var e=allStudents.filter(e=>e.name.toLowerCase().includes(t)||e.class_name&&e.class_name.toLowerCase().includes(t)||e.id.toLowerCase().includes(t));renderPagination("studentPagination",e.length,studentPage,e=>{studentPage=e,renderStudents()}),e.slice((studentPage-1)*pageSize,studentPage*pageSize).forEach(e=>{var t=document.createElement("tr");t.innerHTML=`
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="/api/students/${e.id}/photo" class="student-img" onerror="this.src='../logo.png'" onclick="showImg(this.src)">
                            <div>
                                <div style="font-weight: 700; font-size: 0.85rem;">${e.name}</div>
                                <div style="font-size: 0.7rem; color: #94a3b8;">ID: ${e.id} | ${e.stars} â­</div>
                            </div>
                        </div>
                    </td>
                    <td style="font-size: 0.85rem; font-weight: 600;">Lá»›p ${e.class_name}</td>
                    <td style="text-align: right; white-space: nowrap;">
                        <button type="button" class="btn" style="padding: 4px 8px; font-size: 0.75rem; background: rgba(255,255,255,0.05); color: white;" onclick="openEditStudent('${e.id}')">âœï¸ Sá»­a</button>
                        <button type="button" class="btn" style="padding: 4px 8px; font-size: 0.75rem; background: rgba(239,68,68,0.1); color: #ef4444;" onclick="deleteStudent('${e.id}')">ğŸ—‘ï¸ XÃ³a</button>
                    </td>
                `,n.appendChild(t)})}function renderViolations(){let o=document.getElementById("violationManageBody"),a=(o.innerHTML="",document.getElementById("searchViolation").value.toLowerCase());var e=allViolations.filter(e=>{var t=(e.student_name||"N/A").toLowerCase(),n=(e.type_name||"").toLowerCase(),e=(e.student_id||"").toLowerCase();return t.includes(a)||n.includes(a)||e.includes(a)});renderPagination("violationPagination",e.length,violationPage,e=>{violationPage=e,renderViolations()}),e.slice((violationPage-1)*pageSize,violationPage*pageSize).forEach(t=>{var e=allStudents.find(e=>e.id===t.student_id),n=0<t.points_change,a=t.student_name||"Há»c sinh Ä‘Ã£ bá»‹ xÃ³a",i=t.class_name?"Lá»›p "+t.class_name:"N/A",e=(e&&e.photo,document.createElement("tr"));e.innerHTML=`
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="/api/students/${t.student_id}/photo" class="student-img" onerror="this.src='../logo.png'" onclick="showImg(this.src)">
                            <div>
                                <div style="font-weight: 700; font-size: 0.85rem;">${a}</div>
                                <div style="font-size: 0.7rem; color: #94a3b8;">${i} | ID: ${t.student_id||"N/A"}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div style="font-size: 0.85rem; font-weight: 600; color: ${n?"#10b981":"#ef4444"};">${t.type_name}</div>
                        <div style="font-size: 0.65rem; color: #64748b;">${new Date(t.timestamp).toLocaleString("vi-VN")}</div>
                    </td>
                    <td style="text-align: right;">
                        <button type="button" class="btn" style="padding: 5px 10px; font-size: 0.7rem; background: rgba(99,102,241,0.1); color: #818cf8; border: 1px solid rgba(99,102,241,0.2);" onclick="undoViolation('${t.id}')">â†©ï¸ HoÃ n tÃ¡c</button>
                    </td>
                `,o.appendChild(e)})}function renderPagination(e,t,a,o){let s=document.getElementById(e);s.innerHTML="";var i=Math.ceil(t/pageSize);if(!(i<=1)){let n=(t,e,n=!1,a=!1)=>{var i=document.createElement("button");return i.className="page-btn "+(n?"active":""),i.innerHTML=e,(i.disabled=a)||(i.onclick=e=>{e.stopPropagation(),o(t),s.closest(".card").scrollIntoView({behavior:"smooth"})}),i};s.appendChild(n(a-1,"â€¹ TrÆ°á»›c",!1,1===a));var d=[];if(i<=7)for(let e=1;e<=i;e++)d.push(e);else{d.push(1),4<a&&d.push("...");let t=Math.max(2,a-1),n=Math.min(i-1,a+1);a<=4?(t=2,n=4):i-3<=a&&(t=i-3,n=i-1);for(let e=t;e<=n;e++)-1===d.indexOf(e)&&d.push(e);a<i-3&&d.push("..."),-1===d.indexOf(i)&&d.push(i)}d.forEach(e=>{var t;"..."===e?((t=document.createElement("span")).textContent="...",t.style.padding="0 10px",t.style.color="#94a3b8",s.appendChild(t)):s.appendChild(n(e,e,e===a))}),s.appendChild(n(a+1,"Sau â€º",!1,a===i))}}function renderConfigs(a,e){let i=document.getElementById(e),t=configs[a];i.innerHTML="",Object.entries(t).forEach(([e,t])=>{var n=document.createElement("div");n.style="display: flex; justify-content: space-between; padding: 5px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.8rem;",n.innerHTML=`<span>${t.name} (${0<t.points?"+":""}${t.points})</span><button type="button" style="background: none; border: none; color: #ef4444; font-weight: bold; cursor: pointer;" onclick="deleteConfig('${a}', '${e}')">Ã—</button>`,i.appendChild(n)})}async function addAdminAccount(){var e=document.getElementById("adminId").value.trim().toUpperCase(),t=document.getElementById("adminPass").value.trim(),n=document.getElementById("adminRole").value;e&&t&&(await fetch(API_BASE+"/api/admins",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t,role:n})})).ok&&(fetchAdmins(),document.getElementById("createAdminForm").reset())}async function deleteAdmin(e){showConfirm(`XÃ¡c nháº­n: XÃ³a tÃ i khoáº£n ${e}?`,async()=>{await fetch(API_BASE+"/api/admins/"+e,{method:"DELETE"}),fetchAdmins()})}async function saveDefaultStars(){let e=parseInt(document.getElementById("defaultStarInput").value)||0;showConfirm(`Báº¡n cÃ³ cháº¯c muá»‘n lÆ°u má»©c Ä‘iá»ƒm ban Ä‘áº§u lÃ  ${e} sao?`,async()=>{await fetch(API_BASE+"/api/settings/default_stars",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({default_stars:e})}),fetchConfigs()})}async function applyDefaultToAll(){let e=configs.DefaultStars;showConfirm(`Cáº¢NH BÃO: HÃ nh Ä‘á»™ng nÃ y sáº½ RESET toÃ n bá»™ há»c sinh vá» má»©c ${e} sao. Tiáº¿p tá»¥c?`,async()=>{await fetch(API_BASE+"/api/students/recalculate_all",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({default_stars:e})}),init()})}async function deleteAllViolations(){showConfirm("Cáº¢NH BÃO Cá»°C Äá»˜: Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n XÃ“A Sáº CH toÃ n bá»™ lá»‹ch sá»­ vi pháº¡m khÃ´ng?",async()=>{await fetch(API_BASE+"/api/history/reset_all",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({default_stars:configs.DefaultStars})}),init()})}async function addConfig(e){var t="ViolationTypes"===e?"newV":"newR",n=document.getElementById(t+"Type").value.trim();let a=parseInt(document.getElementById(t+"Point").value)||0;n&&0!==a&&(a="ViolationTypes"===e?-Math.abs(a):Math.abs(a),await fetch(API_BASE+"/api/settings/"+e.toLowerCase(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,points:a})}),document.getElementById(t+"Type").value="",document.getElementById(t+"Point").value="",fetchConfigs())}async function deleteConfig(e,t){showConfirm(`XÃ³a loáº¡i ${"ViolationTypes"===e?"vi pháº¡m":"khen thÆ°á»Ÿng"} nÃ y?`,async()=>{await fetch(`${API_BASE}/api/settings/${e.toLowerCase()}/`+t,{method:"DELETE"}),fetchConfigs()})}async function deleteStudent(e){showConfirm("XÃ¡c nháº­n: XÃ“A há»c sinh nÃ y vÃ  toÃ n bá»™ lá»‹ch sá»­ vi pháº¡m?",async()=>{(await fetch(API_BASE+"/api/students/"+e,{method:"DELETE"})).ok&&fetchStudents()})}async function undoViolation(e){showConfirm("HÃ nh Ä‘á»™ng nÃ y sáº½ xÃ³a báº£n ghi vÃ  hoÃ n láº¡i Ä‘iá»ƒm cho há»c sinh. Tiáº¿p tá»¥c?",async()=>{await fetch(API_BASE+"/api/history/"+e,{method:"DELETE"}),init()})}async function addClass(){var e=document.getElementById("className").value.trim();e&&(await fetch(API_BASE+"/api/classes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})}),document.getElementById("className").value="",fetchClasses())}async function deleteClass(e){showConfirm(`XÃ³a lá»›p ${e}?`,async()=>{await fetch(API_BASE+"/api/classes/"+e,{method:"DELETE"}),fetchClasses()})}function openEditStudent(t){var e=allStudents.find(e=>e.id===t);e&&(document.getElementById("editSid").value=t,document.getElementById("editName").value=e.name,document.getElementById("editClass").value=e.class_name,document.getElementById("editStudentModal").style.display="flex")}async function saveStudentEdit(){var e=document.getElementById("editSid").value,t=document.getElementById("editName").value,n=document.getElementById("editClass").value;await fetch(API_BASE+"/api/students",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,name:t,class_name:n,is_update:!0})}),closeEditModal(),fetchStudents()}function closeEditModal(){document.getElementById("editStudentModal").style.display="none"}function logout(){sessionStorage.clear(),window.location.href="../index.html"}function showImg(e){e&&(document.getElementById("imgFull").src=e,document.getElementById("imageModal").style.display="flex")}function closeImg(){document.getElementById("imageModal").style.display="none"}function filterStudents(){studentPage=1,renderStudents()}function filterViolations(){violationPage=1,renderViolations()}function exportStudentsExcel(){var e=XLSX.utils.json_to_sheet(allStudents.map(e=>({MSHS:e.id,"Há» tÃªn":e.name,"Lá»›p":e.class_name,"Sá»‘ sao":e.stars}))),t=XLSX.utils.book_new();XLSX.utils.book_append_sheet(t,e,"Students"),XLSX.writeFile(t,"HocSinh.xlsx")}function exportViolationsExcel(){var e=XLSX.utils.json_to_sheet(allViolations.map(e=>({"Thá»i gian":new Date(e.timestamp).toLocaleString(),"Há»c sinh":e.student_name,"Lá»›p":e.class_name,"Ná»™i dung":e.type_name,"Äiá»ƒm":e.points_change}))),t=XLSX.utils.book_new();XLSX.utils.book_append_sheet(t,e,"History"),XLSX.writeFile(t,"LichSu.xlsx")}document.getElementById("btnConfirmYes").onclick=function(){confirmCallback&&confirmCallback(),closeConfirm()},window.firebaseBackendReady?init():window.addEventListener("firebaseBackendReady",init),window.addEventListener("socket_data_changed",init),setInterval(()=>{fetchConfigs(),fetchAdmins(),fetchStudents(),fetchHistory()},3e4)</script></body></html>