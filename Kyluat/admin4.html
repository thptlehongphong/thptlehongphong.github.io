<!DOCTYPE html><html lang="vi"><head><meta charset="UTF-8"><meta name="viewport" content="width=1100"><title>Admin 4 - C·ªông ƒêi·ªÉm R√®n Luy·ªán</title><link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet"><script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script><script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script><script src="../student_data.js"></script><style>:root{--primary:#6366f1;--success:#10b981;--glass:rgba(255, 255, 255, 0.05);--glass-border:rgba(255, 255, 255, 0.1)}*{margin:0;padding:0;box-sizing:border-box;font-family:Outfit,sans-serif}body{background:#0f172a;color:#fff;min-height:100vh;padding:20px 5%}.container{max-width:600px;margin:0 auto}.card{background:var(--glass);border:1px solid var(--glass-border);border-radius:24px;padding:25px;margin-bottom:20px}.search-box{display:flex;gap:10px;margin-bottom:20px}input[type=text]{flex:1;padding:14px;border-radius:12px;border:1px solid var(--glass-border);background:#1e293b;color:#fff;outline:0}.btn{padding:12px 20px;border-radius:12px;border:none;font-weight:600;cursor:pointer;transition:.3s}.btn-primary{background:var(--primary);color:#fff}.btn-success{background:var(--success);color:#fff;width:100%;margin-top:15px}.student-result{display:none;animation:fadeIn .5s}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.student-profile{display:flex;align-items:center;gap:20px;margin-bottom:25px}.profile-img{width:100px;height:100px;border-radius:15px;object-fit:cover;border:2px solid var(--success);cursor:zoom-in}.star-badge{display:inline-flex;align-items:center;gap:5px;background:rgba(245,158,11,.2);color:#f59e0b;padding:5px 12px;border-radius:20px;font-weight:700;margin-top:10px}textarea{width:100%;padding:12px;border-radius:12px;border:1px solid var(--glass-border);background:#1e293b;color:#fff;outline:0;margin-top:15px;min-height:100px}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:2000;justify-content:center;align-items:center;backdrop-filter:blur(5px)}.modal-content{max-width:90%;max-height:90%;border-radius:20px;border:2px solid var(--primary)}</style></head><body><div class="container"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px"><h3>Admin 4 - Khen Th∆∞·ªüng</h3><button style="background:0 0;border:none;color:#fff;cursor:pointer" onclick="logout()">Tho√°t</button></div><div class="card"><div class="search-box"><input type="text" id="searchId" placeholder="Nh·∫≠p MSHS ƒë·ªÉ khen th∆∞·ªüng..."> <button class="btn btn-primary" onclick="searchStudent()">T√¨m</button></div><div id="studentResult" class="student-result"><div class="student-profile"><img id="resImg" class="profile-img" src="" alt="" onclick="showImg(this.src)"><div><h2 id="resName"></h2><p id="resInfo" style="color:#94a3b8;font-size:.9rem"></p><div class="star-badge"><span id="resStars">0</span> ‚≠ê</div></div></div><div style="border-top:1px solid var(--glass-border);padding-top:20px"><p style="margin-bottom:15px;font-weight:600">Ch·ªçn l√Ω do khen th∆∞·ªüng:</p><div id="rewardOptionsContainer" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:15px"></div><textarea id="rewardNote" placeholder="Ghi ch√∫ chi ti·∫øt th√™m (n·∫øu c√≥)..." style="margin-top:15px;min-height:80px"></textarea> <button class="btn btn-success" onclick="submitReward()">X√°c Nh·∫≠n TƒÉng Sao</button></div></div><div id="noMatch" style="display:none;text-align:center;color:#ef4444;padding:20px">Kh√¥ng t√¨m th·∫•y h·ªçc sinh v·ªõi m√£ s·ªë n√†y!</div></div></div><div id="imageModal" class="modal" onclick="closeImg()"><img class="modal-content" id="imgFull"></div><script src="firebase.config.js"></script><script>let currentRole=sessionStorage.getItem("kyluat_role"),rewardTypesConf=("admin4"!==currentRole&&"admin0"!==currentRole&&(window.location.href="../index.html"),{});function renderRewardOptions(){let n=document.getElementById("rewardOptionsContainer");n.innerHTML="",0===Object.keys(rewardTypesConf).length?n.innerHTML='<p style="color:#94a3b8; grid-column:span 2;">Ch∆∞a c√≥ danh m·ª•c khen th∆∞·ªüng n√†o.</p>':Object.entries(rewardTypesConf).forEach(([,e])=>{var t=document.createElement("div");t.style="background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border); padding: 12px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: 0.2s;",t.onclick=function(){var e=this.querySelector("input");e.checked=!e.checked,this.style.background=e.checked?"#ffffff":"rgba(255,255,255,0.03)",this.style.color=e.checked?"#0f172a":"white",this.style.fontWeight=e.checked?"700":"normal"},t.className="r-item",t.dataset.points=e.points,t.innerHTML=`
                    <input type="checkbox" value="${e.name}" style="pointer-events:none;">
                    <span>${e.name} <small style="color:#10b981">(+${e.points})</small></span>
                `,n.appendChild(t)})}function showImg(e){var t;e&&(t=document.getElementById("imageModal"),document.getElementById("imgFull").src=e,t.style.display="flex")}function closeImg(){document.getElementById("imageModal").style.display="none"}rootRef.child("Settings").on("value",e=>{var t=e.val()&&e.val().Config||{status:"active"},n=(new Date).toISOString().split("T")[0],n=t.expiryDate&&n>t.expiryDate,o="locked"===t.status;(n||o)&&"admin0"!==currentRole&&(alert(t.message||"H·ªá th·ªëng ƒë√£ b·ªã kh√≥a ho·∫∑c h·∫øt h·∫°n!"),window.location.href="../index.html"),rewardTypesConf=e.val()&&e.val().RewardTypes||{},renderRewardOptions()});let currentStudent=null;async function searchStudent(){let t=document.getElementById("searchId").value.trim().toUpperCase();if(t){let e=null;"undefined"!=typeof STATIC_STUDENTS&&(e=STATIC_STUDENTS.find(e=>e.id===t));var n=await rootRef.child("Students").child(t).once("value");n.exists()||e?(n=n.val()||{},currentStudent={studentId:t,name:n.name||(e?e.name:""),class:n.class||(e?e.class:""),photo:n.photo||(e?e.photo:""),stars:n.stars||0},document.getElementById("resImg").src=currentStudent.photo,document.getElementById("resName").textContent=currentStudent.name,document.getElementById("resInfo").textContent="L·ªõp: "+currentStudent.class,document.getElementById("resStars").textContent=currentStudent.stars||0,document.getElementById("studentResult").style.display="block",document.getElementById("noMatch").style.display="none"):(currentStudent=null,document.getElementById("studentResult").style.display="none",document.getElementById("noMatch").style.display="block")}}async function submitReward(){if(currentStudent){var t=document.querySelectorAll(".r-item input:checked");let n=[],o=0;if(t.forEach(e=>{var t=e.closest(".r-item");n.push(e.value),o+=parseInt(t.dataset.points)||1}),0===n.length)alert("Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 m·ª•c!");else{t=document.getElementById("rewardNote").value.trim();let e="üëç Khen th∆∞·ªüng: "+n.join(", ");t&&(e+=` (Chi ti·∫øt: ${t})`);t={studentId:currentStudent.studentId,studentName:currentStudent.name,studentClass:currentStudent.class,studentPhoto:currentStudent.photo,violationType:e,totalPoints:o,timestamp:Date.now(),recordedBy:sessionStorage.getItem("kyluat_id")};await rootRef.child("Violations").push(t),await rootRef.child("Students").child(currentStudent.studentId).transaction(e=>(e&&(e.stars=(e.stars||0)+o),e)),alert(`ƒê√£ t·∫∑ng ${o} sao th√†nh c√¥ng!`),location.reload()}}}function logout(){sessionStorage.clear(),window.location.href="../index.html"}</script></body></html>