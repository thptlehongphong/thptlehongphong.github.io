<!DOCTYPE html><html lang="vi"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Admin 0 - Super Control Panel</title><link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet"><script type="module" src="../firebase-backend.js"></script><style>:root{--primary:#8b5cf6;--danger:#ef4444;--glass:rgba(255, 255, 255, 0.05);--glass-border:rgba(255, 255, 255, 0.1)}*{margin:0;padding:0;box-sizing:border-box;font-family:Outfit,sans-serif}body{background:#0f172a;color:#fff;min-height:100vh;padding:40px 5%}.container{max-width:800px;margin:0 auto}.card{background:var(--glass);border:1px solid var(--glass-border);border-radius:24px;padding:30px;margin-bottom:30px}h2{margin-bottom:20px;color:var(--primary);display:flex;align-items:center;gap:10px}.form-group{margin-bottom:20px}label{display:block;margin-bottom:8px;color:#94a3b8;font-size:.9rem}input,select{width:100%;padding:12px;border-radius:12px;border:1px solid var(--glass-border);background:rgba(255,255,255,.03);color:#fff;outline:0;transition:.3s}input:focus{border-color:var(--primary)}.btn{padding:12px 24px;border-radius:12px;border:none;font-weight:600;cursor:pointer;transition:.3s}.btn-primary{background:var(--primary);color:#fff}.btn-danger{background:var(--danger);color:#fff}.status-badge{padding:5px 12px;border-radius:20px;font-size:.8rem;font-weight:700}.status-active{background:rgba(16,185,129,.2);color:#10b981}.status-locked{background:rgba(239,68,68,.2);color:#ef4444}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(15,23,42,.9);z-index:9999;justify-content:center;align-items:center;backdrop-filter:blur(8px)}.modal-content{background:#1e293b;border:1px solid var(--glass-border);padding:30px;border-radius:24px;max-width:400px;width:90%;text-align:center;box-shadow:0 25px 50px -12px rgba(0,0,0,.5);animation:modalPop .2s ease-out}@keyframes modalPop{from{transform:scale(.9);opacity:0}to{transform:scale(1);opacity:1}}.modal-btns{display:flex;gap:12px;margin-top:25px}.modal-btns .btn{flex:1}.notify-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(15,23,42,.9);z-index:9999;justify-content:center;align-items:center;backdrop-filter:blur(8px)}.notify-content{background:#1e293b;border:1px solid var(--glass-border);padding:30px;border-radius:24px;max-width:400px;width:90%;text-align:center;box-shadow:0 25px 50px -12px rgba(0,0,0,.5);animation:modalPop .2s ease-out}.notify-icon{font-size:40px;margin-bottom:15px;display:block}.notify-title{font-size:1.25rem;font-weight:700;margin-bottom:10px}.notify-msg{color:#cbd5e1;line-height:1.5;margin-bottom:25px;font-size:.95rem}.notify-error .notify-title{color:#ef4444}.notify-success .notify-title{color:#10b981}#imageModal .modal-content{max-width:90%;max-height:90%;border-radius:20px;border:2px solid var(--primary)}</style></head><body><div class="container"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:40px"><h1>Super Admin (Admin 0)</h1><button type="button" class="btn btn-danger" onclick="logout()">Tho√°t</button></div><div class="card"><h2>üë§ Qu·∫£n L√Ω Danh S√°ch Admin 1</h2><p style="color:#94a3b8;font-size:.85rem;margin-bottom:20px">T·∫°o v√† qu·∫£n l√Ω c√°c t√†i kho·∫£n Admin 1 (Ng∆∞·ªùi ƒëi·ªÅu h√†nh ch√≠nh).</p><div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:20px"><div class="form-group" style="margin-bottom:0"><label>ID ƒêƒÉng nh·∫≠p Admin 1</label> <input type="text" id="admin1Id" placeholder="VD: ADMIN_LHP"></div><div class="form-group" style="margin-bottom:0"><label>M·∫≠t kh·∫©u</label> <input type="text" id="admin1Pass" placeholder="VD: lhp123456"></div></div><button type="button" class="btn btn-primary" onclick="addAdmin1()" style="width:100%">Th√™m Admin 1 M·ªõi</button><div style="margin-top:30px"><table style="width:100%;border-collapse:collapse"><thead><tr style="text-align:left;border-bottom:1px solid var(--glass-border)"><th style="padding:10px;color:#94a3b8">ID</th><th style="padding:10px;color:#94a3b8">M·∫≠t kh·∫©u</th><th style="padding:10px;color:#94a3b8;text-align:right">H√†nh ƒë·ªông</th></tr></thead><tbody id="admin1TableBody"></tbody></table></div></div><div class="card"><h2>‚öôÔ∏è C·∫•u H√¨nh H·ªá Th·ªëng</h2><p style="color:#94a3b8;font-size:.85rem;margin-bottom:20px">ƒêi·ªÅu h√†nh th·ªùi gian s·ª≠ d·ª•ng v√† tr·∫°ng th√°i kh√≥a c·ªßa to√†n b·ªô h·ªá th·ªëng.</p><div class="form-group"><label>Ng√†y h·∫øt h·∫°n s·ª≠ d·ª•ng</label> <input type="date" id="expiryDate"><p id="daysRemaining" style="margin-top:5px;font-size:.8rem;color:var(--primary)"></p></div><div class="form-group"><label>Ph√¢n quy·ªÅn ho·∫°t ƒë·ªông (T·∫Øt/B·∫≠t t·ª´ng Admin)</label><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;background:rgba(255,255,255,.03);padding:15px;border-radius:12px;border:1px solid var(--glass-border)"><div style="display:flex;align-items:center;gap:10px"><input type="checkbox" id="permAdmin1" style="width:20px;height:20px"> <label for="permAdmin1" style="margin:0">Cho ph√©p Admin 1</label></div><div style="display:flex;align-items:center;gap:10px"><input type="checkbox" id="permAdmin2" style="width:20px;height:20px"> <label for="permAdmin2" style="margin:0">Cho ph√©p Admin 2</label></div><div style="display:flex;align-items:center;gap:10px"><input type="checkbox" id="permAdmin3" style="width:20px;height:20px"> <label for="permAdmin3" style="margin:0">Cho ph√©p Admin 3</label></div><div style="display:flex;align-items:center;gap:10px"><input type="checkbox" id="permAdmin4" style="width:20px;height:20px"> <label for="permAdmin4" style="margin:0">Cho ph√©p Admin 4</label></div></div></div><div class="form-group"><label>Th√¥ng b√°o hi·ªÉn th·ªã khi kh√≥a/h·∫øt h·∫°n</label> <input type="text" id="systemMessage" placeholder="VD: H·ªá th·ªëng ƒëang b·∫£o tr√¨. Vui l√≤ng quay l·∫°i sau."></div><button type="button" class="btn btn-primary" onclick="saveConfig()" style="width:100%">L∆∞u C·∫•u H√¨nh T·ªïng</button></div></div><div id="confirmModal" class="modal"><div class="modal-content"><h3 style="margin-bottom:15px;color:var(--danger)">‚ö†Ô∏è X√°c Nh·∫≠n X√≥a</h3><p id="confirmMsg" style="color:#cbd5e1;line-height:1.5">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t√†i kho·∫£n n√†y kh√¥ng?</p><div class="modal-btns"><button type="button" class="btn btn-danger" id="btnConfirmYes">ƒê·ªìng √Ω</button> <button type="button" class="btn" style="background:#475569;color:#fff" onclick="closeConfirm()">Tho√°t</button></div></div></div><div id="imageModal" class="modal" onclick="closeImg()"><img class="modal-content" id="imgFull"></div><div id="notifyModal" class="notify-modal"><div class="notify-content" id="notifyContent"><span id="notifyIcon" class="notify-icon"></span><h3 id="notifyTitle" class="notify-title"></h3><p id="notifyMsg" class="notify-msg"></p><button type="button" class="btn btn-primary" onclick="closeNotify()">ƒê·ªìng √Ω</button></div></div><script>let API_BASE="",admin1IdInput=("admin0"!==sessionStorage.getItem("kyluat_role")&&(window.location.href="../index.html"),document.getElementById("admin1Id")),admin1PassInput=document.getElementById("admin1Pass"),expiryDateInput=document.getElementById("expiryDate"),permAdmin1=document.getElementById("permAdmin1"),permAdmin2=document.getElementById("permAdmin2"),permAdmin3=document.getElementById("permAdmin3"),permAdmin4=document.getElementById("permAdmin4"),systemMessageInput=document.getElementById("systemMessage"),daysRemainingText=document.getElementById("daysRemaining"),admin1TableBody=document.getElementById("admin1TableBody");async function initData(){await fetchAdmins(),await fetchSettings()}async function fetchAdmins(){try{var e=await(await fetch(API_BASE+"/api/admins")).json();admin1TableBody.innerHTML="",e.forEach(e=>{var n;"admin1"===e.role&&((n=document.createElement("tr")).style.borderBottom="1px solid rgba(255,255,255,0.05)",n.innerHTML=`
                        <td style="padding: 10px;">${e.username}</td>
                        <td style="padding: 10px;">${e.password}</td>
                        <td style="padding: 10px; text-align: right;">
                            <button class="btn btn-danger" style="padding: 5px 12px; font-size: 0.75rem;" onclick="deleteAdmin1('${e.username}')">X√≥a</button>
                        </td>
                    `,admin1TableBody.appendChild(n))})}catch(e){console.error(e)}}async function fetchSettings(){try{var e,n,t=await(await fetch(API_BASE+"/api/settings")).json(),i=(expiryDateInput.value=t.expiry_date||"",systemMessageInput.value=t.system_message||"",JSON.parse(t.permissions||'{"admin1":true,"admin2":true,"admin3":true,"admin4":true}'));permAdmin1.checked=!1!==i.admin1,permAdmin2.checked=!1!==i.admin2,permAdmin3.checked=!1!==i.admin3,permAdmin4.checked=!1!==i.admin4,t.expiry_date&&(e=new Date(t.expiry_date)-new Date,n=Math.ceil(e/864e5),daysRemainingText.textContent=0<n?`C√≤n ${n} ng√†y s·ª≠ d·ª•ng`:"ƒê√£ h·∫øt h·∫°n!")}catch(e){console.error(e)}}async function addAdmin1(){var e=admin1IdInput.value.trim().toUpperCase(),n=admin1PassInput.value.trim();e&&n&&((await fetch(API_BASE+"/api/admins",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:n,role:"admin1"})})).ok?(showNotify("Th√†nh c√¥ng",`ƒê√£ th√™m Admin 1: ${e} th√†nh c√¥ng!`),admin1IdInput.value="",admin1PassInput.value="",fetchAdmins()):showNotify("L·ªói","Kh√¥ng th·ªÉ th√™m t√†i kho·∫£n Admin 1!",!0))}window.firebaseBackendReady?initData():window.addEventListener("firebaseBackendReady",initData);let adminToDelete=null;function deleteAdmin1(e){adminToDelete=e,document.getElementById("confirmMsg").innerText=`X√°c nh·∫≠n quan tr·ªçng: B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën X√ìA t√†i kho·∫£n ${e} kh√¥ng?
D·ªØ li·ªáu tr√™n h·ªá th·ªëng s·∫Ω b·ªã x√≥a vƒ©nh vi·ªÖn.`,document.getElementById("confirmModal").style.display="flex"}function closeConfirm(){document.getElementById("confirmModal").style.display="none",adminToDelete=null}function showImg(e){e&&(document.getElementById("imgFull").src=e,document.getElementById("imageModal").style.display="flex")}function closeImg(){document.getElementById("imageModal").style.display="none"}function showNotify(e,n,t=!1){var i=document.getElementById("notifyModal"),a=document.getElementById("notifyContent"),d=document.getElementById("notifyIcon"),o=document.getElementById("notifyTitle"),m=document.getElementById("notifyMsg");a.className="notify-content "+(t?"notify-error":"notify-success"),d.innerText=t?"‚ö†Ô∏è":"‚úÖ",o.innerText=e,m.innerText=n,i.style.display="flex"}function closeNotify(){document.getElementById("notifyModal").style.display="none"}async function saveConfig(){var e,n,t={expiry_date:expiryDateInput.value,system_message:systemMessageInput.value.trim(),permissions:JSON.stringify({admin1:permAdmin1.checked,admin2:permAdmin2.checked,admin3:permAdmin3.checked,admin4:permAdmin4.checked})};for([e,n]of Object.entries(t))await fetch(API_BASE+"/api/settings/"+e,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({[e]:n})});showNotify("ƒê√£ l∆∞u","ƒê√£ c·∫≠p nh·∫≠t c·∫•u h√¨nh h·ªá th·ªëng th√†nh c√¥ng!")}async function cleanDatabasePhotos(){if(confirm("X√°c nh·∫≠n l·∫ßn cu·ªëi: X√ìA TO√ÄN B·ªò ·∫¢NH TR√äN DATABASE?"))try{(await fetch(API_BASE+"/api/students/clean_photos",{method:"POST"})).ok?showNotify("Ho√†n t·∫•t","ƒê√£ d·ªçn d·∫πp c√°c ·∫£nh kh√¥ng s·ª≠ d·ª•ng th√†nh c√¥ng!"):showNotify("L·ªói","Kh√¥ng th·ªÉ d·ªçn d·∫πp ·∫£nh v√†o l√∫c n√†y!",!0)}catch(e){showNotify("L·ªói k·∫øt n·ªëi",e.message,!0)}}async function exportStaticData(){if(confirm("H·ªá th·ªëng s·∫Ω t·∫£i to√†n b·ªô danh s√°ch h·ªçc sinh. Ti·∫øp t·ª•c?"))try{var e=await(await fetch(API_BASE+"/api/students")).json(),n=e.map(e=>({id:e.id,name:e.name,class:e.class_name,photo:e.photo||""})),t=`const STATIC_STUDENTS = ${JSON.stringify(n,null,2)};`,i=new Blob([t],{type:"text/javascript"}),a=URL.createObjectURL(i),d=document.createElement("a");d.href=a,d.download="student_data.js",d.click(),URL.revokeObjectURL(a),showNotify("ƒê√£ xu·∫•t Excel",`ƒê√£ tr√≠ch xu·∫•t d·ªØ li·ªáu c·ªßa ${e.length} h·ªçc sinh ra file JS.`)}catch(e){showNotify("L·ªói Export",e.message,!0)}}function logout(){sessionStorage.clear(),window.location.href="../index.html"}document.getElementById("btnConfirmYes").onclick=async function(){var e;adminToDelete&&(e=adminToDelete,closeConfirm(),(await fetch(API_BASE+"/api/admins/"+e,{method:"DELETE"})).ok?(showNotify("ƒê√£ x√≥a",`ƒê√£ g·ª° b·ªè t√†i kho·∫£n ${e} kh·ªèi danh s√°ch.`),fetchAdmins()):showNotify("L·ªói","L·ªói khi g·ª° b·ªè t√†i kho·∫£n!",!0))}</script></body></html>